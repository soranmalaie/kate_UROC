<!DOCTYPE html>
<html>
    <head>
        <title>FYP_Extended</title>
        <script src="https://unpkg.com/jspsych@7.3.1"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
        <script src="https://unpkg.com/@jspsych/plugin-sketchpad@1.0.3"></script>
        <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.2"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.2"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey@0.2.1"></script>
        <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.1"></script>
        <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.1.1"></script>  
        <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>      
        <script src="https://unpkg.com/@jspsych/plugin-browser-check@1.0.1"></script>
        <script src="https://unpkg.com/@jspsych/plugin-video-keyboard-response@1.1.1"></script>

        <link href="https://unpkg.com/jspsych@7.3.1/css/jspsych.css" rel="stylesheet" type="text/css" />
    </head>
    <body></body>
    <script>

        // experiment ID from DataPipe
        const expID = "mpvQSL8NChQb";
              
        // intialize jsPsych
        var jsPsych = initJsPsych({
            on_finish: function() {
                jsPsych.data.displayData();

            }
        });

        //To run the experiment without Prolific website 
        // const subject_id = jsPsych.randomization.randomID(10);
        // jsPsych.data.addProperties({subject_id: subject_id});

        //To run the experiment from Prolific website 
        // capture info from Prolific

        // var subject_id = jsPsych.data.getURLVariable('PROLIFIC_PID');
        // var study_id = jsPsych.data.getURLVariable('STUDY_ID');
        // var session_id = jsPsych.data.getURLVariable('SESSION_ID');
        // jsPsych.data.addProperties({
        //     subject_id: subject_id,
        //     study_id: study_id,
        //     session_id: session_id
        // });
        
        
        const subject_id = jsPsych.randomization.randomID(10);
        jsPsych.data.addProperties({subject_id: subject_id});



        var timeline = [];

        var tr_duration = 3000;
        var venice_path = ['Maze_Map.png'];
       
        //preloading the Venice map
        var preload = {
            type: jsPsychPreload,
            images: venice_path,

        };
        timeline.push(preload);

        // Change to full screen mode
        var run_fullscreen = {
            type: jsPsychFullscreen,
            fullscreen_mode: true,
        }
        timeline.push(run_fullscreen);

        //check the screen size
        var screen_check = {
            type: jsPsychBrowserCheck,
            minimum_width: 1100,
            minimum_height: 760,

            exclusion_message: (data) => {
                if(data.mobile){
                    return '<p>You must use a desktop/laptop computer to participate in this experiment.</p>'+
                    ' Please return the experiment to Prolific.</p>';
                }
                else{
                    return '<p>The size of your browser window does not meet the requirements to participate in this experiment.'+
                        ' Please return the experiment to Prolific.</p>'; 
                }
            }
        };
        timeline.push(screen_check);

        // welcoming message
        var greeting = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: "Welcome to the experiment! Press any key to start.",
        };
        timeline.push(greeting);

        var consent_form = {
            type: jsPsychInstructions,
            pages: [

                '<p style="font-size:24px;font-weight:bold;">CONSENT TO PARTICIPATE IN A RESEARCH STUDY<p> ' +
                '<p style="class=positivefeedback; text-align:left; font-size:18px">'+
                '<b>Study Title: Reasoning and Learning</b><p>' + 
                '<p style="text-align:left"><b>Investigator Name, Department, Telephone Number:</b>'+
                '<p style="text-align:left">Prof. Tyler Marghetis, Cognitive and Information Sciences, 619-252-7798<p>'+
                '<p style="text-align:left"><b>PURPOSE</b>'+
                '<p style="text-align:left">You are being asked to participate in a research study conducted by Prof. Tyler Marghetis'+
                ' at the University of California, Merced.  We hope to learn about how people reason about abstract concepts and complex topics.'+
                '<p style="text-align:left"><b>PROCEDURES</b><p>'+
                '<p style="text-align:left">If you choose to be in the study, you will be asked to answer questions, solve puzzles, and/or describe your reasoning.'+
                ' You will respond by writing, speaking, typing, and/or clicking on a computer screen. We may record your responses, '+
                'including all interactions with the computer. These tasks allow us to better understand how people learn and reason.'+
                ' This should take between 5 minutes and one hour. The study will be completed either in-person or online on your computer.'+
                ' You can stop the study at any time. Approximately 5,000 people will participate in this study.'+
                '<p style="text-align:left"><b>ALTERNATIVES </b>'+
                '<p style="text-align:left">If you are receiving extra credit in connection with or as part of a course, your instructor must offer you other options for obtaining credit, if you decline to participate.'+
                '<p style="text-align:left"><b>RISKS</b>'+
                '<p style="text-align:left">Participants should generally not experience any risks beyond those of daily living and computer use. One potential risk is frustration when trying to solve more difficult reasoning problems.'+
                '<p style="text-align:left"><b>BENEFITS</b>'+
                '<p style="text-align:left">It is possible that you will not benefit directly by participating in this study. '+
                '<p style="text-align:left"><b>CONFIDENTIALITY</b>'+
                '<p style="text-align:left">Absolute confidentiality cannot be guaranteed, since research documents are not protected from subpoena. We will not ask for any identifiable information.'+
                ' The data collected in this study could be used for future research studies or distributed to other investigators for future research studies without additional informed consent from the subject or legally authorized representative.'+
                ' The information collected during this study may be presented at conferences, published in scientific journals, and shared with other researchers.'+
                ' Identifiable information will be removed before the data is shared. Individual privacy will be maintained and identities will not be disclosed.'+
                '<p style="text-align:left"><b>COSTS/COMPENSATION</b>'+
                '<p style="text-align:left">If you are volunteering, you will receive a small token gift as a sign of our appreciation. If you are participating in return for payment, you will be compensated approximately $8/hour for participating in this study.'+
                ' If you are participating in return for course credit, you will be compensated through the SONA system with course credit (0.5 credit per half-hour), even if you do not complete the study. There is no cost to you beyond the time and effort required to complete the procedure(s) described above.'+
                '<p style="text-align:left"><b>RIGHT TO REFUSE OR WITHDRAW</b>'+
                '<p style="text-align:left">Participation is completely voluntary.  You may refuse to participate in this study.  You may change your mind about being in the study and quit after the study has started.'+
                '<p style="text-align:left"><b>QUESTIONS</b>'+
                '<p style="text-align:left">If you have any questions about this research project please contact Prof. Tyler Marghetis, who will answer them at 619-252-7798 or tmarghetis@ucmerced.edu'+
                'For questions about your rights while taking part in this study call the Office of Research at (209) 228-4613 or write to the Office of Research,5200 North Lake Rd, UC Merced, Merced, CA 95343.'+
                ' The Office of Research will inform the Institutional Review Board which is a group of people who review the research to protect your rights.  If you have any complaints or concerns about this study, you may address them to Rose Scott, Chair of the IRB at (209) 228-4362, irbchair@ucmerced.edu.'+
                '<p style="text-align:left"><b>CONSENT</b>'+
                '<p style="text-align:left"><b>By choosing to continue to the next screen, you indicate that you have decided to participate as a research subject and that you have read and understood the information provided above. You may save a copy of this form to keep for your records. </b><p>'
            ],
            show_clickable_nav: true, 
            button_label_next: 'Agree & Continue' 
        };
        timeline.push(consent_form)

        
        var let_set = [
                        "<b>ab</b>",
                        "<b>da</b>",
                        "<b>ea</b>",
                        "<b>gl</b>",
                        "<b>gr</b>",
                        "<b>le</b>",
                        "<b>mi</b>",
                        "<b>pr</b>",
                        "<b>st</b>",
                        "<b>zo</b>",							
                    ];
        var shuffled_let_set = jsPsych.randomization.repeat(let_set, 1);
   
        var CRAP_set = [
                        '<b>pie' + '\xa0\xa0\xa0\xa0' + 'luck' + '\xa0\xa0\xa0\xa0' + 'belly</b>',
                        '<b>opera' + '\xa0\xa0\xa0\xa0' + 'hand' + '\xa0\xa0\xa0\xa0' + 'dish</b>',
                        '<b>dust' + '\xa0\xa0\xa0\xa0' + 'cereal' + '\xa0\xa0\xa0\xa0' + 'fish</b>',
                        '<b>light' + '\xa0\xa0\xa0\xa0' + 'birthday' + '\xa0\xa0\xa0\xa0' + 'stick</b>',
                        '<b>palm' + '\xa0\xa0\xa0\xa0' + 'shoe' + '\xa0\xa0\xa0\xa0' + 'house</b>',
                        '<b>sage' + '\xa0\xa0\xa0\xa0' + 'paint' + '\xa0\xa0\xa0\xa0' + 'hair</b>',
                        '<b>french' + '\xa0\xa0\xa0\xa0' + 'car' + '\xa0\xa0\xa0\xa0' + 'shoe</b>',
                        '<b>carpet' + '\xa0\xa0\xa0\xa0' + 'alert' + '\xa0\xa0\xa0\xa0' + 'ink</b>',
                        '<b>mouse' + '\xa0\xa0\xa0\xa0' + 'bear' + '\xa0\xa0\xa0\xa0' + 'sand</b>',
                        '<b>show' + '\xa0\xa0\xa0\xa0' + 'life' + '\xa0\xa0\xa0\xa0' + 'row</b>',
                    ];
        var shuffled_CRAP_set = jsPsych.randomization.repeat(CRAP_set, 1);

        var Venice1_prompt_linear = [

            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the follwoing location (hold <b>Ctrl</b> to draw):<p> <b>E<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the follwoing location (hold <b>Ctrl</b> to draw):<p> <b>I<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the follwoing location (hold <b>Ctrl</b> to draw):<p> <b>L<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the follwoing location (hold <b>Ctrl</b> to draw):<p> <b>Y<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the follwoing location (hold <b>Ctrl</b> to draw):<p> <b>B<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the follwoing location (hold <b>Ctrl</b> to draw):<p> <b>R<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the follwoing location (hold <b>Ctrl</b> to draw):<p> <b>H<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the follwoing location (hold <b>Ctrl</b> to draw):<p> <b>V<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the follwoing location (hold <b>Ctrl</b> to draw):<p> <b>D<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the follwoing location (hold <b>Ctrl</b> to draw):<p> <b>T<b> <p>",
        ];

                                 
        var Venice1_prompt_diverse = [
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the following locations (hold <b>Ctrl</b> to draw):<p> <b>M, Z, N, F, K<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the following locations (hold <b>Ctrl</b> to draw):<p> <b>C, D, U, B, P<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the following locations (hold <b>Ctrl</b> to draw):<p> <b>A, M, R, T, F<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the following locations (hold <b>Ctrl</b> to draw):<p> <b>U, V, Z, N, K<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the following locations (hold <b>Ctrl</b> to draw):<p> <b>E, J, C, Y, P<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the following locations (hold <b>Ctrl</b> to draw):<p> <b>Z, A, B, I, L<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the following locations (hold <b>Ctrl</b> to draw):<p> <b>N, P, T, U, V<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the following locations (hold <b>Ctrl</b> to draw):<p> <b>R, I, A, F, D<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the following locations (hold <b>Ctrl</b> to draw):<p> <b>Y, M, J, Z, E<b> <p>",
            "<p>Imagine there are five items on the red dot. Deliver the items from the red spot to the following locations (hold <b>Ctrl</b> to draw):<p> <b>K, A, P, N, C<b> <p>",
        ];

        // between task message
        var task1_done = {
            type: jsPsychInstructions,
            pages: [
            '<p style="font-size:32px;font-weight:bold;">End of Task 1<p> ' +
                '<p style="class=positivefeedback;font-size:24px">'+
                'You have finished the first of two tasks. Whenever you are ready to continue, please click Next to start the second half of the experiment.'
            ],
        show_clickable_nav: true,

        on_start: function() {
            jsPsych.pluginAPI.clearAllTimeouts();
        },

        };

        var video_instruction_linear = {
            type: jsPsychVideoKeyboardResponse,
            prompt: "Reminder: Hold <b>Ctrl</b> on your keyboard to draw. <P> When the video has finished, hit <b>Enter</b> to start the task.",
            stimulus: [
                'Linear_final.mp4'
            ],
            width: window.innerWidth,
            height: window.innerHeight,
            // choices: "Enter",
            // trial_ends_after_video: true,
            // controls: true,
            response_allowed_while_playing: false,
        };

        var video_instruction_diverse = {
            type: jsPsychVideoKeyboardResponse,
            prompt: "Reminder: Hold <b>Ctrl</b> on your keyboard to draw. <P> When the video has finished, hit <b>Enter</b> to start the task.",
            stimulus: [
                'Diverse_final.mp4'
            ],
            width: window.innerWidth,
            height: window.innerHeight,
            // choices: "Enter",
            // trial_ends_after_video: true,
            // controls: true,
            response_allowed_while_playing: false,
        };
        
        async function createExperiment(){
            const condition = await jsPsychPipe.getCondition(expID);
                         

            //linear condition 'if'
            if(condition == 0) {

            var Venice1_counter = -1;
        
            var Venice1_task = {
            type: jsPsychSketchpad,
            prompt: function(){
                Venice1_counter +=1;
                return Venice1_prompt_linear[Venice1_counter]
            },
            prompt_location:'abovecanvas',
            background_image: venice_path,
            key_to_draw: 'Control',
            finished_button_label: 'Continue',
            canvas_width: 1080,
            canvas_height: 750,
            canvas_border_width: 3,
            save_strokes: false,
            show_clear_button: false,

            on_start: function() {
                let_counter += 1;
                jsPsych.pluginAPI.clearAllTimeouts();
            },
                
            on_finish: function(data){
                const filename = `${subject_id}_${jsPsych.getProgress().current_trial_global}_image.png`;
                jsPsychPipe.saveBase64Data(expID,  filename, data.png);
                // delete the base64 data to save space. store the filename instead.
                data.png = filename;
            },

            };

            var let_counter = -1;

            var let_set_task = {
            type: jsPsychSurveyHtmlForm,
            preamble: function(){
                return shuffled_let_set[let_counter]
            },
            autofocus: 'test-resp-box',
            button_label: "Enter",
            timeline: [
                {html: '<p> <input name="let_linear" type="text" id="test-resp-box" /></p>',},
                ],
            sample: {
                type: 'fixed-repetitions',
                size:  25
            },
            }
        
            var let_set_procedures = {
            timeline: [Venice1_task, let_set_task],
            repetitions: let_set.length,
            
            on_start: function() {
                jsPsych.pluginAPI.setTimeout(function() {
                    jsPsych.endCurrentTimeline();
                    jsPsych.finishTrial({Response: "timeout"});
                }, tr_duration);
            }
            }

            var Venice2_counter = -1;
        
            var Venice2_task = {
            type: jsPsychSketchpad,
            prompt: function(){
                Venice2_counter +=1;
                return Venice1_prompt_linear[Venice2_counter]
            },

            prompt_location:'abovecanvas',
            background_image: venice_path,
            key_to_draw: 'Control',
            finished_button_label: 'Continue',
            canvas_width: 1080,
            canvas_height: 750,
            canvas_border_width: 3,
            save_strokes: false,
            show_clear_button: false,

            on_start: function() {
                jsPsych.pluginAPI.clearAllTimeouts();
            },
                                
            on_finish: function(data){
                const filename = `${subject_id}_${jsPsych.getProgress().current_trial_global}_image.png`;
                jsPsychPipe.saveBase64Data(expID,  filename, data.png);
                // delete the base64 data to save space. store the filename instead.
                data.png = filename;
            },

            };
        
            var CRAP_counter = -1;

            var CRAP_set_task = {
            type: jsPsychSurveyHtmlForm,
            preamble: function(){
                CRAP_counter += 1;
                return shuffled_CRAP_set[CRAP_counter]},

            html: 
                '<p> <input name="CRAP_linear" type="text" id="test-resp-box"  style="width:200px;height:50px;" /></p>',

            autofocus: 'test-resp-box',
            button_label: "Enter",
           
            on_start: function() {
                jsPsych.pluginAPI.clearAllTimeouts();
                
                jsPsych.pluginAPI.setTimeout(function() {
                jsPsych.finishTrial({Response: "timeout"});
                }, tr_duration);
            },                            
            };

       

            var CRAP_procedures = {
            
            timeline: [Venice2_task, CRAP_set_task],        
            repetitions: CRAP_set.length,

            }

            // Use the randomization plugin to randomly choose which function to push first
            var functionOrder = jsPsych.randomization.shuffle([let_set_procedures, CRAP_procedures]);
            
            // Push the functions into the timeline in the randomly determined order
            if(functionOrder[0] == let_set_procedures){

            var let_set_instruction_linear1 = {
                type: jsPsychInstructions,
                pages: [

                    '<p style="font-size:32px;font-weight:bold;">Instructions<p> ' +
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'In this task, you will see the first two letters of possible words. For each pair of letters,' + 
                    ' you will have <b>30 seconds</b> to type in as many English words as you can that begin with those letters. ' + 
                    'For example, for <b>lo</b>, you can write down words such as love, low, lobster, lord,' +
                    ' locomotion, and so on.<p>' + 
                    '<p style="font-size:24px;">You <b>cannot</b> use proper nouns, such as names of places or people (e. g. London, Lora). You can' + 
                    ' be specific in your responses, but do not waste your time by adding different suffixes. For example, '+
                    'love, lover, lovely and loved will be counted just once. Keep in mind that wrong words do not ' + 
                    'have negative points; so, if you doubt whether a word is acceptable, just type it in, hit Enter to be saved instantly, and continue ' +
                    'searching for more words.',
                    '<p style="font-size:24px;">Before each trial, you will be shown the following map in which you need to deliver some items from the starting points ' + 
                    '(the red dots on the map) to a location. To do this, simply draw five lines, one by one, from the red dots to the location that will be mentioned above the map;'+
                    ' To draw a line hold <b>Ctrl</b> button on your keyboard and move your mouse cursor. ' + 
                    'You should draw the lines oonly through the roads and without crossing over the bulidings, and then click on the <b>continue</b> button ' +
                    'to see the next trial.'+
                    ' Do not rush in delivering the items as your 30 seconds time to complete a trial will begin only after ' + 
                    'pushing the Continue button. You will see a video as an example  of how to deliver the items.' + '<br>' +
                    '<img src="Maze_Map.png"></img>'
                ],
                show_clickable_nav: true
            };
            timeline.push(let_set_instruction_linear1)
            timeline.push(video_instruction_linear);
            timeline.push(functionOrder[0]);
            timeline.push(task1_done);
            
            var CRAP_instruction_linear2 = {
                type: jsPsychInstructions,
                pages: [
                    '<p style="font-size:32px;font-weight:bold;">Instructions<p> ' +
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'In this task, you will see three words and your job is to find the fourth word that makes a common'+
                    ' two-word phrase with each of them. For example, if you saw “aid    rubber    wagon”, then the correct'
                    +' fourth word that makes a common two-word phrase with each of them is “band” — as in band-aid, rubber'+
                    ' band, and bandwagon. Another example is “cream    skate    water”.   What word makes a common two-word '+
                    'phrase with each of them? It is ice — as in, ice cream, ice skate, and ice water. '+
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'For each set of three words, you will have up to <b>30 seconds</b> to come up with your solution.'+
                    ' Please type your solution and hit Enter right away.',
                    '<p style="font-size:24px;">Like the previous task, before each trial, you will be shown the following map'+
                    ' in which you need to deliver some items from the starting points ' + 
                    '(the red dots on the map) to a location. To do this, simply draw five lines, one by one,'+
                    ' from the red dots to the location that will be mentioned above the map;'+
                    ' To draw a line hold <b>Ctrl</b> button on your keyboard and move your mouse cursor. ' + 
                    'You should draw the lines only through the roads and without crossing over the bulidings,'+
                    ' and then click on the <b>Continue</b> button to see the next trial.'+
                    ' Do not rush in delivering the items as your 30 seconds time to complete a trial will begin only after ' + 
                    'pushing the Continue button.' + '<br>' +
                    '<img src="Maze_Map.png"></img>'
                ],
            show_clickable_nav: true
            };

            timeline.push(CRAP_instruction_linear2)
            timeline.push(functionOrder[1]);
            }
            
            if(functionOrder[0] == CRAP_procedures){

            
            var CRAP_instruction_linear1 = {
                type: jsPsychInstructions,
                pages: [
                    '<p style="font-size:32px;font-weight:bold;">Instructions<p> ' +
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'In this task, you will see three words and your job is to find the fourth word that makes a common'+
                    ' two-word phrase with each of them. For example, if you saw “aid    rubber    wagon”, then the correct'
                    +' fourth word that makes a common two-word phrase with each of them is “band” — as in band-aid, rubber'+
                    ' band, and bandwagon. Another example is “cream    skate    water”.   What word makes a common two-word '+
                    'phrase with each of them? It is ice — as in, ice cream, ice skate, and ice water. '+
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'For each set of three words, you will have up to <b>30 seconds</b> to come up with your solution.'+
                    ' Please type your solution and hit Enter right away.',
                    '<p style="font-size:24px;">Before each trial, you will be shown the following map'+
                    ' in which you need to deliver some items from the starting points ' + 
                    '(the red dots on the map) to a location. To do this, simply draw five lines, one by one,'+
                    ' from the red dots to the location that will be mentioned above the map;'+
                    ' To draw a line hold <b>Ctrl</b> button on your keyboard and move your mouse cursor. ' + 
                    'You should draw the lines only through the roads and without crossing over the bulidings,'+
                    ' and then click on the <b>Continue</b> button to see the next trial.'+
                    ' Do not rush in delivering the items as your 30 seconds time to complete a trial will begin only after ' + 
                    'pushing the Continue button. You will see a video as an example of how to deliver the items.' + '<br>' +
                    '<img src="Maze_Map.png"></img>'
                ],
            show_clickable_nav: true

            };
            timeline.push(CRAP_instruction_linear1)

            timeline.push(video_instruction_linear);
            timeline.push(functionOrder[0]);
            timeline.push(task1_done);
            var let_set_instruction_linear2 = {
                type: jsPsychInstructions,
                pages: [

                    '<p style="font-size:32px;font-weight:bold;">Instructions<p> ' +
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'In this task, you will see the first two letters of possible words. For each pair of letters,' + 
                    ' you will have <b>30 seconds</b> to type in as many English words as you can that begin with those letters. ' + 
                    'For example, for <b>lo</b>, you can write down words such as love, low, lobster, lord,' +
                    ' locomotion, and so on.<p>' + 
                    '<p style="font-size:24px;">You <b>cannot</b> use proper nouns, such as names of places or people (e. g. London, Lora). You can' + 
                    ' be specific in your responses, but do not waste your time by adding different suffixes. For example, '+
                    'love, lover, lovely and loved will be counted just once. Keep in mind that wrong words do not ' + 
                    'have negative points; so, if you doubt whether a word is acceptable, just type it in, hit Enter to be saved instantly, and continue ' +
                    'searching for more words.',
                    '<p style="font-size:24px;">Like the previous task, before each trial, you will be shown the following map in which you need to deliver some items from the starting points ' + 
                    '(the red dots on the map) to a location. To do this, simply draw five lines, one by one, from the red dots to the location that will be mentioned above the map;'+
                    ' To draw a line hold <b>Ctrl</b> button on your keyboard and move your mouse cursor. ' + 
                    'You should draw the lines through the roads and without crossing over the bulidings, and then click on the <b>continue</b> button ' +
                    'to see the next trial.'+
                    ' Do not rush in delivering the items as your 30 seconds time to complete a trial will begin only after ' + 
                    'pushing the Continue button.' + '<br>' +
                    '<img src="Maze_Map.png"></img>'
                ],
                show_clickable_nav: true      
            };
            timeline.push(let_set_instruction_linear2);
            timeline.push(functionOrder[1]);

            }

        };


        //diverse condition 'if'
        if(condition == 1) { 
            var Venice1_counter = -1;

            var Venice1_task = {
            type: jsPsychSketchpad,
            prompt: function(){
                Venice1_counter +=1;
                return Venice1_prompt_diverse[Venice1_counter]
            },
            prompt_location:'abovecanvas',
            background_image: venice_path,
            key_to_draw: 'Control',
            finished_button_label: 'Continue',
            canvas_width: 1080,
            canvas_height: 750,
            canvas_border_width: 3,
            save_strokes: false,
            show_clear_button: false,

            on_start: function() {
                let_counter += 1;
                jsPsych.pluginAPI.clearAllTimeouts();
            },
                                
            on_finish: function(data){
                const filename = `${subject_id}_${jsPsych.getProgress().current_trial_global}_image.png`;
                jsPsychPipe.saveBase64Data(expID,  filename, data.png);
                // delete the base64 data to save space. store the filename instead.
                data.png = filename;
            },

            };

            var let_counter = -1;

            var let_set_task = {
            type: jsPsychSurveyHtmlForm,
            preamble: function(){
                return shuffled_let_set[let_counter]
            },
            autofocus: 'test-resp-box',
            button_label: "Enter",
            timeline: [
                {html: '<p> <input name="let_diverse" type="text" id="test-resp-box" /></p>',},
                ],
            sample: {
                type: 'fixed-repetitions',
                size:  25
            },
            }
        
            var let_set_procedures = {
            timeline: [Venice1_task, let_set_task],
            repetitions: let_set.length,
            
            on_start: function() {
                jsPsych.pluginAPI.setTimeout(function() {
                    jsPsych.endCurrentTimeline();
                    jsPsych.finishTrial({Response: "timeout"});
                }, tr_duration);
            }
            }

            var Venice2_counter = -1;

            var Venice2_task = {
            type: jsPsychSketchpad,
            prompt: function(){
                Venice2_counter +=1;
                return Venice1_prompt_diverse[Venice2_counter]
            },
            prompt_location:'abovecanvas',
            background_image: venice_path,
            key_to_draw: 'Control',
            finished_button_label: 'Continue',
            canvas_width: 1080,
            canvas_height: 750,
            canvas_border_width: 3,
            save_strokes: false,
            show_clear_button: false,

            on_start: function() {
                jsPsych.pluginAPI.clearAllTimeouts();
            },
                                
            on_finish: function(data){
                const filename = `${subject_id}_${jsPsych.getProgress().current_trial_global}_image.png`;
                jsPsychPipe.saveBase64Data(expID,  filename, data.png);
                // delete the base64 data to save space. store the filename instead.
                data.png = filename;
            },

            };
        
            var CRAP_counter = -1;

            var CRAP_set_task = {
            type: jsPsychSurveyHtmlForm,
            preamble: function(){
                CRAP_counter += 1;
                return shuffled_CRAP_set[CRAP_counter]},

            html: 
                '<p> <input name="CRAP_diverse" type="text" id="test-resp-box"  style="width:200px;height:50px;" /></p>',

            autofocus: 'test-resp-box',
            button_label: "Enter",
           
            on_start: function() {
                jsPsych.pluginAPI.clearAllTimeouts();
                
                jsPsych.pluginAPI.setTimeout(function() {
                jsPsych.finishTrial({Response: "timeout"});
                }, tr_duration);
            },                            
            };

            var CRAP_procedures = {
            
            timeline: [Venice2_task, CRAP_set_task],        
            repetitions: CRAP_set.length,

            }

            // Use the randomization plugin to randomly choose which function to push first
            var functionOrder = jsPsych.randomization.shuffle([let_set_procedures, CRAP_procedures]);
            
            // Push the functions into the timeline in the randomly determined order
            if(functionOrder[0] == let_set_procedures){

            
            var let_set_instruction_diverse1 = {
                type: jsPsychInstructions,
                pages: [                
                    '<p style="font-size:32px;font-weight:bold;">Instructions<p> ' +
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'In this task, you will see the first two letters of possible words. For each pair of letters,' + 
                    ' you will have <b>30 seconds</b> to type in as many English words as you can that begin with those letters. ' + 
                    'For example, for <b>lo</b>, you can write down words such as love, low, lobster, lord,' +
                    ' locomotion, and so on.<p>' + 
                    '<p style="font-size:24px;">You <b>cannot</b> use proper nouns, such as names of places or people (e. g. London, Lora). You can' + 
                    ' be specific in your responses, but do not waste your time by adding different suffixes. For example, '+
                    'love, lover, lovely and loved will be counted just once. Keep in mind that wrong words do not ' + 
                    'have negative points; so, if you doubt whether a word is acceptable, just type it in, hit Enter to be saved instantly, and continue ' +
                    'searching for more words.',
                    '<p style="font-size:24px;">Before each trial, you will be shown the following map in which you need to deliver some items from the starting point ' + 
                    '(the red dot on the map) to different locations. To do this, simply draw five lines, one by one,'+
                    ' from the red dot to the locations that will be mentioned above the map;'+
                    ' To draw a line hold <b>Ctrl</b> button on your keyboard and move your mouse cursor. ' + 
                    'You should draw the lines only through the roads and without crossing over the bulidings, and then click on the <b>Continue</b> button ' +
                    'to see the next trial. Do not rush in delivering the items as your 30 seconds time to complete a trial will begin only after ' + 
                    'pushing the Continue button. You will see a video as an example of how to deliver the items.' + '<br>' +
                    '<img src="Maze_Map.png"></img>'
                ],
            show_clickable_nav: true                  
            };
            timeline.push(let_set_instruction_diverse1);
            timeline.push(video_instruction_diverse);
            timeline.push(functionOrder[0]);
            timeline.push(task1_done);
            var CRAP_instruction_diverse2 = {
                type: jsPsychInstructions,
                pages: [
                    '<p style="font-size:32px;font-weight:bold;">Instructions<p> ' +
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'In this task, you will see three words and your job is to find the fourth word that makes a common'+
                    ' two-word phrase with each of them. For example, if you saw “aid    rubber    wagon”, then the correct'
                    +' fourth word that makes a common two-word phrase with each of them is “band” — as in band-aid, rubber'+
                    ' band, and bandwagon. Another example is “cream    skate    water”.   What word makes a common two-word '+
                    'phrase with each of them? It is ice — as in, ice cream, ice skate, and ice water. '+
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'For each set of three words, you will have up to <b>30 seconds</b> to come up with your solution.'+
                    ' Please type your solution and hit Enter right away.',
                    '<p style="font-size:24px;">Like the previous task, before each trial, you will be shown the following map'+
                    ' in which you need to deliver some items from the starting point ' + 
                    '(the red dot on the map) to different locations. To do this, simply draw five lines, one by one,'+
                    ' from the red dot to the locations that will be mentioned above the map;'+
                    ' To draw a line hold <b>Ctrl</b> button on your keyboard and move your mouse cursor. ' + 
                    'You should draw the lines only through the roads and without crossing over the bulidings,'+
                    ' and then click on the <b>Continue</b> button to see the next trial. Do not rush in'+
                    ' delivering the items as your 30 seconds time to complete a trial will begin only after ' + 
                    'pushing the Continue button.' + '<br>' +
                    '<img src="Maze_Map.png"></img>'
                ],
            show_clickable_nav: true                      
            };
            timeline.push(CRAP_instruction_diverse2);
            timeline.push(functionOrder[1]);
            }

            if(functionOrder[0] == CRAP_procedures){

            var CRAP_instruction_diverse1 = {
                type: jsPsychInstructions,
                pages: [
                    '<p style="font-size:32px;font-weight:bold;">Instructions<p> ' +
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'In this task, you will see three words and your job is to find the fourth word that makes a common'+
                    ' two-word phrase with each of them. For example, if you saw “aid    rubber    wagon”, then the correct'
                    +' fourth word that makes a common two-word phrase with each of them is “band” — as in band-aid, rubber'+
                    ' band, and bandwagon. Another example is “cream    skate    water”.   What word makes a common two-word '+
                    'phrase with each of them? It is ice — as in, ice cream, ice skate, and ice water. '+
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'For each set of three words, you will have up to <b>30 seconds</b> to come up with your solution.'+
                    ' Please type your solution and hit Enter right away.',
                    '<p style="font-size:24px;">Before each trial, you will be shown the following map'+
                    ' in which you need to deliver some items from the starting point ' + 
                    '(the red dot on the map) to different locations. To do this, simply draw five lines, one by one,'+
                    ' from the red dot to the locations that will be mentioned above the map;'+
                    ' To draw a line hold <b>Ctrl</b> button on your keyboard and move your mouse cursor. ' + 
                    'You should draw the lines only through the roads and without crossing over the bulidings,'+
                    ' and then click on the <b>Continue</b> button to see the next trial. Do not rush in'+
                    ' delivering the items as your 30 seconds time to complete a trial will begin only after ' + 
                    'pushing the Continue button. You will see a video as an example of how to deliver the items.' + '<br>' +
                    '<img src="Maze_Map.png"></img>'
                ],
            show_clickable_nav: true                      
            };
            timeline.push(CRAP_instruction_diverse1);

            timeline.push(video_instruction_diverse);
            timeline.push(functionOrder[0]);
            timeline.push(task1_done);
            
            var let_set_instruction_diverse2 = {
                type: jsPsychInstructions,
                pages: [                
                    '<p style="font-size:32px;font-weight:bold;">Instructions<p> ' +
                    '<p style="class=positivefeedback;font-size:24px">'+
                    'In this task, you will see the first two letters of possible words. For each pair of letters,' + 
                    ' you will have <b>30 seconds</b> to type in as many English words as you can that begin with those letters. ' + 
                    'For example, for <b>lo</b>, you can write down words such as love, low, lobster, lord,' +
                    ' locomotion, and so on.<p>' + 
                    '<p style="font-size:24px;">You <b>cannot</b> use proper nouns, such as names of places or people (e. g. London, Lora). You can' + 
                    ' be specific in your responses, but do not waste your time by adding different suffixes. For example, '+
                    'love, lover, lovely and loved will be counted just once. Keep in mind that wrong words do not ' + 
                    'have negative points; so, if you doubt whether a word is acceptable, just type it in, hit Enter to be saved instantly, and continue ' +
                    'searching for more words.',
                    '<p style="font-size:24px;">Like the previous task, before each trial, you will be shown the following map in which you need to deliver some items from the starting point ' + 
                    '(the red dot on the map) to different locations. To do this, simply draw five lines, one by one,'+
                    ' from the red dot to the locations that will be mentioned above the map;'+
                    ' To draw a line hold <b>Ctrl</b> button on your keyboard and move your mouse cursor. ' + 
                    'You should draw the lines only through the roads and without crossing over the bulidings, and then click on the <b>Continue</b> button ' +
                    'to see the next trial. Do not rush in delivering the items as your 30 seconds time to complete a trial will begin only after ' + 
                    'pushing the Continue button.' + '<br>' +
                    '<img src="Maze_Map.png"></img>'
                ],
            show_clickable_nav: true                  
            };
            timeline.push(let_set_instruction_diverse2);

            timeline.push(functionOrder[1]);

            }

        };


        // After the main two tasks message
        var tasks_finished = {
            type: jsPsychInstructions,
            pages: [
            '<p style="font-size:32px;font-weight:bold;">End of Task 2<p> ' +
                '<p style="class=positivefeedback;font-size:24px">'+
                'Great! The experiment is almost done! Next, you will see a list of names. Some of them are authors of books or novels, and some are not.'+
                ' Please put a check mark next to the names that you know <b>for sure</b> are authors. There is a penalty '+
                'for guessing, so you should check only those names about which you are absolutely certain.'
            ],
            show_clickable_nav: true,

            on_start: function() {
                jsPsych.pluginAPI.clearAllTimeouts();
            },

        };
        timeline.push(tasks_finished);

        //Author Recognition Test        
        var ART = {
            type: jsPsychSurvey,
            pages:
            [
              [
    
                {
                    type: 'multi-select',
                    prompt: "Which of these names are authors? Select all that apply.", 
                    options: [
                      
                          'Patrick Banville', 'Harry Coltheart', 'Virginia Woolf', 'Tony Hillerman',
                          'Kristen Steinke', 'Gary Curwen', 'John Landau', 'Amy R. Baskin',
                          'Ernest Hemingway', 'Herman Wouk', 'Toni Morrison', 'James Clavell',
                          'Clive Cussler', 'Geoffrey Pritchett', 'Harriet Troudeau', 'Salmon Rushdie',
                          'Hiroyuki Oshita', 'Ray Bradbury', 'Roswell Strong', 'Maryann Phillips',
                          'Kurt Vonnegut', 'Jay Peter Holmes', 'J.R.R. Tolkien', 'Scott Alexander',
                          'Anne McCaffrey', 'Christina Johnson', 'Margaret Atwood', 'Ayn Rand',
                          'Elinor Harring', 'Jean M. Auel', 'Seamus Huneven', 'Alex D. Miles',
                          'Sue Grafton', 'Judith Stanley', 'Harper Lee', 'Margaret Mitchell',
                          'Lisa Woodward', 'Gloria McCumber', 'Chris Schwartz', 'Leslie Kraus',
                          'David Harper Townsend', 'James Joyce', 'Walter LeMour', 'Ralph Ellison',
                          'Anna Tsing', 'Robert Ludlum', 'Alice Walker', 'Sidney Sheldon',
                          'T.C. Boyle', 'Larry Applegate', 'Elizabeth Engle', 'Brian Herbert',
                          'Jonathan Kellerman', 'Keith Cartwright', 'T.S. Elliot', 'Sue Hammond',
                          'Cameron McGrath', 'Jackie Collins', 'Marvin Benoit', 'Jared Gibbons',
                          'F. Scott Fitzgerald', 'Umberto Eco', 'Joyce Carol Oates', 'Michael Ondaatje',
                          'A.C. Kelly', 'David Ashley', 'Jessica Ann Lewis', 'Thomas Wolfe',
                          'Peter Flaegerty', 'Jack London', 'Nelson Demille', 'Jeremy Weissman',
                          'Kazuo Ishiguro', 'Seth Bakis', 'Arturo Garcia Perez', 'Willa Cather',
                          'Jane Smiley', 'Padraig Oseaghdha', 'S.L. Holloway', 'J.D. Salinger',
                          'James Patterson', 'E.B. White', 'John Irving', 'Antonia Cialdini',
                          'Martha Farah', 'Giles Mallon', 'Stephen Houston', 'Lisa Hong Chan',
                          'Craig DeLord', 'Raymond Chandler', 'Marcus Lecherou', 'Samuel Beckett',
                          'Nora Ephron', 'Isabel Allende', 'Valerie Cooper', 'Beatrice Dobkin',
                          'Ann Beattie', 'Amy Graham', 'Tom Clancy', 'Wally Lamb',
                          'Stewart Simon', 'Marion Coles Snow', 'Vladimir Nabokov', 'Katherine Kreutz',
                          'Danielle Steel', 'George Orwell', 'Pamela Lovejoy', 'James Michener',
                          'Dick Francis', 'Maya Angelou', 'Vikram Roy', 'William Faulkner',
                          'Ted Mantel', 'Bernard Malamud', 'Saul Bellow', 'Isaac Asimov',
                          'I.K. Nachbar', 'John Grisham', 'Stephen King', 'Lindsay Carter',
                          'Judith Krantz', 'Erich Fagles', 'Elizabeth May Kenyon', 'Paul Theroux',
                          'Thomas Pynchon', 'Walter Dorris', 'Frederick Mundow', 'Francine Preston',
                          'Wayne Fillback', 'Gabriel Garcia Marquez'

 
                    ],
                    columns: 5,
                    name: 'Author',                      
                }
              ]
            ],
        }
        timeline.push(ART);

            
        //Collecting demographic information
        var demographic_info = {
            type: jsPsychSurvey,
            pages: [
                [
                    {
                        type: 'multi-choice',
                        prompt: "Are you a native English Speaker?", 
                        options: ['Yes','No'],
                        name: 'Langauge',
                        required: true,
                    },
                    {
                        type: 'text',
                        prompt: 'Do you know a second language, besides English? If so, enter it here:',
                        placeholder: 'Example: Spanish',
                        name: '2ndLanguage'
                    },
                    {
                        type: 'likert',
                        prompt: 'Please rate your fluency in your second language:',
                        name: '2nd_lg_fluency',
                        likert_scale_min_label: 'Beginner',
                        likert_scale_max_label: 'Fluent',
                        likert_scale_values: [
                        {value: 1},
                        {value: 2},
                        {value: 3},
                        {value: 4},
                        {value: 5}
                        ]
                    },                     
                    {
                        type: 'text',
                        prompt: 'Do you know a third language? If so, enter it here',
                        name: 'SecondLanguage'
                    },
                    {
                        type: 'likert',
                        prompt: 'Please rate your fluency in your third language:',
                        name: '3rd_lg_fluency',
                        likert_scale_min_label: 'Beginner',
                        likert_scale_max_label: 'Fluent',
                        likert_scale_values: [
                        {value: 1},
                        {value: 2},
                        {value: 3},
                        {value: 4},
                        {value: 5}
                        ]
                    },
                ],
                [

                    {
                        type: 'text',
                        prompt: "How old are you in years?",
                        name: 'age', 
                        textbox_columns: 5,
                        required: true,
                    },
                    {
                        type: 'multi-choice',
                        prompt: "What is the highest level of education that you have completed?", 
                        options: [
                            'Less than high school degree','High school graduate (high school diploma or equivalent including GED)',
                            'Some college but no degree', 'Associate degree in college (2-year)',
                            'Bachelors degree in college (4-year)', 'Masters degree',
                            'Doctoral degree (e.g., PhD, MD, JD)'
                        ],
                        name: 'Highest_degree', 
                        required: true,
                    },

                    {
                        type: 'multi-choice',
                        prompt: "What is your dominant hand?",
                        options:[
                            'Right', 'Left', 'Ambidextrous (Equally well with both hands)'
                        ], 
                        name: 'Handedness', 
                        required: true,
                    },
                ],

                [
                    {
                        type: 'multi-select',
                        prompt: 'What is your race? (choose all that apply) ',
                        options:[
                            'White', 'Spanish, Hispanic, or Latino', 'Black or African American', 'American Indian or Alaska Native',
                            'Asian','Native Hawaiian or Pacific Islander','Not listed or prefer not to say'
                        ],
                        name: 'Race',
                        required: true,

                    },
                    {
                        type: 'multi-choice',
                        prompt: "Which of the following best describes your sexual orientation?", 
                        options: [
                            'straight (heterosexual)','gay or lesbian (homosexual)', 'bisexual', 'queer',
                            'asexual', 'not listed or prefer not to respond' 
                        ],
                        name: 'sexual_orientation', 
                        required: true,
                    },
                    {
                        type: 'multi-choice',
                        prompt: "Which of the following best describes your gender identity? ", 
                        options: [
                            'man', 'woman', 'non-binary', 'transgender woman', 'transgender man', 'genderqueer',
                            'not listed', 'prefer not to respond'
                        ],
                        name: 'gender', 
                        required: true,
                    },
                ],
            ],
            title: 'Please enter the following information',
            button_label_finish: 'Submit',
        };
        timeline.push(demographic_info);

        var final_comment = {
            type: jsPsychSurvey,
            pages: [
                
                [

                    {
                        type: 'text',
                        prompt: "Do you have any comments on this study? If you don't have comments, just click NEXT to continue.",
                        name: 'final_comment', 
                        textbox_columns: 80,
                        textbox_rows: 10,
                    },
                    
                ],
            ],
            button_label_finish: 'NEXT',
        };
        timeline.push(final_comment);

        var Exp_Done = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: "Please press Enter for your results to be saved. Do not close this window; you will be redirected to the Prolific website automatically to get your credit after we received your results."+
            " It may take one minute, or longer depending on your internet speed! <p><b>Thank you for your participation :) </b>",
        };
        timeline.push(Exp_Done);

        const filename = `${subject_id}.csv`;

        const save_data = {
            type: jsPsychPipe,
            action: "save",
            experiment_id: expID,
            filename: filename,
            data_string: ()=>jsPsych.data.get().csv()
        };
        timeline.push(save_data);
        jsPsych.run(timeline);
 
        }
        
        createExperiment();
                  

    </script>

</html>
